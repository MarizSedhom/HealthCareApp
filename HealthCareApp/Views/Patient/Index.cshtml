@model List<PatientVM>

@{
    ViewData["Title"] = "Index";
}

<h1>Patients</h1>

<input type="text" name="name" id="searchInp" placeholder="DetailsByName" class="w-50 p-1 " />
<input type="button" value="Search" class="btn btn-primary ms-3 mb-1" id="searchBtn" onclick="fun()" />

<div id="searchResults"></div>

<div id="initialContent">@Html.Partial("_DetailsByName", Model)</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var currentSearchTerm = "";

    function fun() {
        currentSearchTerm = $('#searchInp').val().trim();

        if (currentSearchTerm === "") {
            alert("Please enter a Clinic name.");
            return;
        }

        loadSearchPage(1);
    }

        function loadSearchPage(page) {
        if (currentSearchTerm === "") {
            window.location.href = '/Patient/GetDoctorPatients?page=' + page + '&pageSize=6';
            return;
        }

        $.ajax({
            url: '/Patient/DetailsByName',
            type: 'GET',
            data: {
                name: currentSearchTerm,
                page: page,
                pageSize: 6
            },
            success: function (result) {
                $('#initialContent').hide();
                $('#searchResults').html(result);
            },
            error: function (xhr) {
                alert('An error occurred: ' + xhr.responseText);
            }
        });
    }
</script>

@*  function search(patientId, doctorId) {
        const targetBodyId = `#medicalRecordsBody_${patientId}`;
        const modalElement = document.querySelector(`#medicalRecordsModal_${patientId}`);
        const modalInstance = bootstrap.Modal.getOrCreateInstance(modalElement);

        // First, hide the modal to prevent showing it prematurely
        modalInstance.hide();

        // Clear any existing content and show loading message
        $(targetBodyId).html('<div class="text-muted">Loading...</div>');

        $.ajax({
            url: '/Patient/SearchForMedicalRecords',
            type: 'GET',
            data: { patientId, doctorId },
            dataType: 'text', // Force as text to parse JSON manually
            success: function (response) {
                try {
                    const json = JSON.parse(response);
                    if (json.redirectTo) {
                        window.location.href = json.redirectTo;
                        return; // Prevent further execution if redirect happens
                    }
                } catch (err) {
                    // Not JSON (indicating partial view): render the response in modal body
                    $(targetBodyId).html(response);

                    // Show modal after content is successfully loaded
                    modalInstance.show();
                }
            },
            error: function (xhr) {
                // Handle error response
                $(targetBodyId).html('<div class="text-danger">An error occurred: ' + xhr.responseText + '</div>');
            }
        });
    } *@

